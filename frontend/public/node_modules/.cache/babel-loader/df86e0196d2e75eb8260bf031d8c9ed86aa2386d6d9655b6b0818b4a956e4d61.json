{"ast":null,"code":"import React,{Fragment,useEffect,useRef}from\"react\";import CheckoutSteps from\"../Cart/CheckoutSteps\";import{useSelector,useDispatch}from\"react-redux\";import MetaData from\"../layout/MetaData\";import{Typography}from\"@material-ui/core\";import{useAlert}from\"react-alert\";import{CardNumberElement,CardCvcElement,CardExpiryElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import axios from\"axios\";import\"./Payment.css\";import CreditCardIcon from\"@material-ui/icons/CreditCard\";import EventIcon from\"@material-ui/icons/Event\";import VpnKeyIcon from\"@material-ui/icons/VpnKey\";import{useNavigate}from\"react-router-dom\";import{createOrder,clearErrors}from\"../../actions/orderAction\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Payment=()=>{const orderInfo=JSON.parse(sessionStorage.getItem(\"orderInfo\"));const navigate=useNavigate();const dispatch=useDispatch();const alert=useAlert();const stripe=useStripe();const elements=useElements();const payBtn=useRef(null);const{shippingInfo,cartItems}=useSelector(state=>state.cart);const{user}=useSelector(state=>state.user);const{error}=useSelector(state=>state.newOrder);const paymentData={amount:Math.round(orderInfo.totalPrice*100)};const order={shippingInfo,orderItems:cartItems,itemsPrice:orderInfo.subtotal,taxPrice:orderInfo.tax,shippingPrice:orderInfo.shippingCharges,totalPrice:orderInfo.totalPrice};const submitHandler=async e=>{e.preventDefault();payBtn.current.disabled=true;try{const config={headers:{\"Content-Type\":\"application/json\"}};const{data}=await axios.post(\"/api/v1/payment/process\",paymentData,config);const client_secret=data.client_secret;if(!stripe||!elements)return;const result=await stripe.confirmCardPayment(client_secret,{payment_method:{card:elements.getElement(CardNumberElement),billing_details:{name:user.name,email:user.email,address:{line1:shippingInfo.address,city:shippingInfo.city,state:shippingInfo.state,postal_code:shippingInfo.pinCode,country:shippingInfo.country}}}});if(result.error){payBtn.current.disabled=false;alert.error(result.error.message);}else{if(result.paymentIntent.status===\"succeeded\"){order.paymentInfo={id:result.paymentIntent.id,status:result.paymentIntent.status};dispatch(createOrder(order));navigate(\"/success\");}else{alert.error(\"There's some while processing payment \");}}}catch(error){payBtn.current.disabled=false;alert.error(error.response.data.message);}};useEffect(()=>{if(error){alert.error(error);dispatch(clearErrors());}},[dispatch,error,alert]);return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(MetaData,{title:\"Payment\"}),/*#__PURE__*/_jsx(CheckoutSteps,{activeStep:2}),/*#__PURE__*/_jsx(\"div\",{className:\"paymentContainer\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"paymentForm\",onSubmit:e=>submitHandler(e),children:[/*#__PURE__*/_jsx(Typography,{children:\"Card Info\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(CreditCardIcon,{}),/*#__PURE__*/_jsx(CardNumberElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(EventIcon,{}),/*#__PURE__*/_jsx(CardExpiryElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(VpnKeyIcon,{}),/*#__PURE__*/_jsx(CardCvcElement,{className:\"paymentInput\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"submit\",value:\"Pay - \\u20B9\".concat(orderInfo&&orderInfo.totalPrice),ref:payBtn,className:\"paymentFormBtn\"})]})})]});};export default Payment;","map":{"version":3,"names":["React","Fragment","useEffect","useRef","CheckoutSteps","useSelector","useDispatch","MetaData","Typography","useAlert","CardNumberElement","CardCvcElement","CardExpiryElement","useStripe","useElements","axios","CreditCardIcon","EventIcon","VpnKeyIcon","useNavigate","createOrder","clearErrors","jsx","_jsx","jsxs","_jsxs","Payment","orderInfo","JSON","parse","sessionStorage","getItem","navigate","dispatch","alert","stripe","elements","payBtn","shippingInfo","cartItems","state","cart","user","error","newOrder","paymentData","amount","Math","round","totalPrice","order","orderItems","itemsPrice","subtotal","taxPrice","tax","shippingPrice","shippingCharges","submitHandler","e","preventDefault","current","disabled","config","headers","data","post","client_secret","result","confirmCardPayment","payment_method","card","getElement","billing_details","name","email","address","line1","city","postal_code","pinCode","country","message","paymentIntent","status","paymentInfo","id","response","children","title","activeStep","className","onSubmit","type","value","concat","ref"],"sources":["C:/Users/anant/OneDrive/Desktop/Project/Coir-Grow/frontend/src/component/Cart/Payment.js"],"sourcesContent":["import React, { Fragment, useEffect, useRef } from \"react\";\r\nimport CheckoutSteps from \"../Cart/CheckoutSteps\";\r\nimport { useSelector, useDispatch  } from \"react-redux\";\r\nimport MetaData from \"../layout/MetaData\";\r\nimport { Typography } from \"@material-ui/core\";\r\nimport { useAlert } from \"react-alert\";\r\nimport {\r\n    CardNumberElement,\r\n    CardCvcElement,\r\n    CardExpiryElement,\r\n    useStripe,\r\n    useElements,\r\n} from \"@stripe/react-stripe-js\";\r\nimport axios from \"axios\";\r\nimport \"./Payment.css\";\r\nimport CreditCardIcon from \"@material-ui/icons/CreditCard\";\r\nimport EventIcon from \"@material-ui/icons/Event\"\r\nimport VpnKeyIcon from \"@material-ui/icons/VpnKey\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { createOrder, clearErrors } from \"../../actions/orderAction\";\r\n\r\nconst Payment = () => {\r\n\r\n   const orderInfo = JSON.parse(sessionStorage.getItem(\"orderInfo\"));\r\n    const navigate = useNavigate();\r\n    const dispatch = useDispatch();\r\n    const alert = useAlert();\r\n    const stripe = useStripe();\r\n    const elements = useElements();\r\n    const payBtn = useRef(null); \r\n   \r\n    const { shippingInfo, cartItems } = useSelector((state) => state.cart);\r\n    const { user } = useSelector((state) => state.user);\r\n    const { error } = useSelector((state) => state.newOrder);\r\n\r\n    const paymentData ={\r\n      amount: Math.round(orderInfo.totalPrice * 100),\r\n    };\r\n\r\n    const order = {\r\n      shippingInfo,\r\n      orderItems: cartItems,\r\n      itemsPrice: orderInfo.subtotal,\r\n      taxPrice: orderInfo.tax,\r\n      shippingPrice: orderInfo.shippingCharges,\r\n      totalPrice: orderInfo.totalPrice, \r\n    };\r\n    const submitHandler = async (e) =>{\r\n      e.preventDefault();\r\n\r\n      payBtn.current.disabled = true;\r\n\r\n      try{\r\n         const config = {\r\n            headers: {\r\n               \"Content-Type\": \"application/json\",\r\n            },\r\n         }\r\n\r\n      \r\n    const { data } = await axios.post(\r\n      \"/api/v1/payment/process\",\r\n      paymentData,\r\n      config\r\n    );\r\n\r\n    const client_secret = data.client_secret;\r\n\r\n    if (!stripe || !elements) return;\r\n\r\n    const result = await stripe.confirmCardPayment(client_secret, {\r\n      payment_method: {\r\n        card: elements.getElement(CardNumberElement),\r\n        billing_details: {\r\n            name: user.name,\r\n            email: user.email,\r\n            address: {\r\n               line1: shippingInfo.address,\r\n               city: shippingInfo.city,\r\n               state: shippingInfo.state,\r\n               postal_code: shippingInfo.pinCode,\r\n               country: shippingInfo.country,\r\n            },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (result.error) {\r\n      payBtn.current.disabled = false;\r\n\r\n      alert.error(result.error.message);\r\n    } else {\r\n      if (result.paymentIntent.status === \"succeeded\"){\r\n          \r\n         order.paymentInfo={\r\n            id: result.paymentIntent.id,\r\n            status: result.paymentIntent.status,\r\n         };\r\n\r\n         dispatch(createOrder(order));\r\n\r\n         navigate(\"/success\");\r\n      } else {\r\n         alert.error (\"There's some while processing payment \");\r\n      }\r\n    }\r\n   } catch (error) {\r\n      payBtn.current.disabled = false;\r\n      alert.error(error.response.data.message);\r\n   }\r\n };\r\n\r\n useEffect(() => {\r\n  if (error) {\r\n   alert.error(error);\r\n   dispatch(clearErrors());\r\n  }\r\n }, [dispatch,error,alert])\r\n\r\n    return (\r\n    <Fragment>\r\n    <MetaData title=\"Payment\" />\r\n    <CheckoutSteps activeStep={2} />\r\n    <div className=\"paymentContainer\">\r\n    <form className=\"paymentForm\" onSubmit={(e) => submitHandler(e)}>\r\n     <Typography>Card Info</Typography>\r\n     <div>\r\n        <CreditCardIcon />\r\n        <CardNumberElement  className=\"paymentInput\" />\r\n     </div>\r\n     <div>\r\n        <EventIcon />\r\n        <CardExpiryElement className=\"paymentInput\" />\r\n     </div>\r\n     <div>\r\n        <VpnKeyIcon />\r\n        <CardCvcElement className=\"paymentInput\"/>\r\n     </div>\r\n     <input\r\n        type= \"submit\"\r\n        value={`Pay - â‚¹${orderInfo && orderInfo.totalPrice }`}\r\n        ref= {payBtn}\r\n        className=\"paymentFormBtn\"\r\n     />\r\n    </form>\r\n    </div>\r\n    </Fragment>\r\n)};\r\n    \r\n\r\nexport default Payment;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAC1D,MAAO,CAAAC,aAAa,KAAM,uBAAuB,CACjD,OAASC,WAAW,CAAEC,WAAW,KAAS,aAAa,CACvD,MAAO,CAAAC,QAAQ,KAAM,oBAAoB,CACzC,OAASC,UAAU,KAAQ,mBAAmB,CAC9C,OAASC,QAAQ,KAAQ,aAAa,CACtC,OACIC,iBAAiB,CACjBC,cAAc,CACdC,iBAAiB,CACjBC,SAAS,CACTC,WAAW,KACR,yBAAyB,CAChC,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,eAAe,CACtB,MAAO,CAAAC,cAAc,KAAM,+BAA+B,CAC1D,MAAO,CAAAC,SAAS,KAAM,0BAA0B,CAChD,MAAO,CAAAC,UAAU,KAAM,2BAA2B,CAClD,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,WAAW,CAAEC,WAAW,KAAQ,2BAA2B,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAErE,KAAM,CAAAC,OAAO,CAAGA,CAAA,GAAM,CAEnB,KAAM,CAAAC,SAAS,CAAGC,IAAI,CAACC,KAAK,CAACC,cAAc,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC,CAChE,KAAM,CAAAC,QAAQ,CAAGb,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAAc,QAAQ,CAAG3B,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAA4B,KAAK,CAAGzB,QAAQ,CAAC,CAAC,CACxB,KAAM,CAAA0B,MAAM,CAAGtB,SAAS,CAAC,CAAC,CAC1B,KAAM,CAAAuB,QAAQ,CAAGtB,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAAuB,MAAM,CAAGlC,MAAM,CAAC,IAAI,CAAC,CAE3B,KAAM,CAAEmC,YAAY,CAAEC,SAAU,CAAC,CAAGlC,WAAW,CAAEmC,KAAK,EAAKA,KAAK,CAACC,IAAI,CAAC,CACtE,KAAM,CAAEC,IAAK,CAAC,CAAGrC,WAAW,CAAEmC,KAAK,EAAKA,KAAK,CAACE,IAAI,CAAC,CACnD,KAAM,CAAEC,KAAM,CAAC,CAAGtC,WAAW,CAAEmC,KAAK,EAAKA,KAAK,CAACI,QAAQ,CAAC,CAExD,KAAM,CAAAC,WAAW,CAAE,CACjBC,MAAM,CAAEC,IAAI,CAACC,KAAK,CAACrB,SAAS,CAACsB,UAAU,CAAG,GAAG,CAC/C,CAAC,CAED,KAAM,CAAAC,KAAK,CAAG,CACZZ,YAAY,CACZa,UAAU,CAAEZ,SAAS,CACrBa,UAAU,CAAEzB,SAAS,CAAC0B,QAAQ,CAC9BC,QAAQ,CAAE3B,SAAS,CAAC4B,GAAG,CACvBC,aAAa,CAAE7B,SAAS,CAAC8B,eAAe,CACxCR,UAAU,CAAEtB,SAAS,CAACsB,UACxB,CAAC,CACD,KAAM,CAAAS,aAAa,CAAG,KAAO,CAAAC,CAAC,EAAI,CAChCA,CAAC,CAACC,cAAc,CAAC,CAAC,CAElBvB,MAAM,CAACwB,OAAO,CAACC,QAAQ,CAAG,IAAI,CAE9B,GAAG,CACA,KAAM,CAAAC,MAAM,CAAG,CACZC,OAAO,CAAE,CACN,cAAc,CAAE,kBACnB,CACH,CAAC,CAGN,KAAM,CAAEC,IAAK,CAAC,CAAG,KAAM,CAAAlD,KAAK,CAACmD,IAAI,CAC/B,yBAAyB,CACzBrB,WAAW,CACXkB,MACF,CAAC,CAED,KAAM,CAAAI,aAAa,CAAGF,IAAI,CAACE,aAAa,CAExC,GAAI,CAAChC,MAAM,EAAI,CAACC,QAAQ,CAAE,OAE1B,KAAM,CAAAgC,MAAM,CAAG,KAAM,CAAAjC,MAAM,CAACkC,kBAAkB,CAACF,aAAa,CAAE,CAC5DG,cAAc,CAAE,CACdC,IAAI,CAAEnC,QAAQ,CAACoC,UAAU,CAAC9D,iBAAiB,CAAC,CAC5C+D,eAAe,CAAE,CACbC,IAAI,CAAEhC,IAAI,CAACgC,IAAI,CACfC,KAAK,CAAEjC,IAAI,CAACiC,KAAK,CACjBC,OAAO,CAAE,CACNC,KAAK,CAAEvC,YAAY,CAACsC,OAAO,CAC3BE,IAAI,CAAExC,YAAY,CAACwC,IAAI,CACvBtC,KAAK,CAAEF,YAAY,CAACE,KAAK,CACzBuC,WAAW,CAAEzC,YAAY,CAAC0C,OAAO,CACjCC,OAAO,CAAE3C,YAAY,CAAC2C,OACzB,CACJ,CACF,CACF,CAAC,CAAC,CAEF,GAAIb,MAAM,CAACzB,KAAK,CAAE,CAChBN,MAAM,CAACwB,OAAO,CAACC,QAAQ,CAAG,KAAK,CAE/B5B,KAAK,CAACS,KAAK,CAACyB,MAAM,CAACzB,KAAK,CAACuC,OAAO,CAAC,CACnC,CAAC,IAAM,CACL,GAAId,MAAM,CAACe,aAAa,CAACC,MAAM,GAAK,WAAW,CAAC,CAE7ClC,KAAK,CAACmC,WAAW,CAAC,CACfC,EAAE,CAAElB,MAAM,CAACe,aAAa,CAACG,EAAE,CAC3BF,MAAM,CAAEhB,MAAM,CAACe,aAAa,CAACC,MAChC,CAAC,CAEDnD,QAAQ,CAACb,WAAW,CAAC8B,KAAK,CAAC,CAAC,CAE5BlB,QAAQ,CAAC,UAAU,CAAC,CACvB,CAAC,IAAM,CACJE,KAAK,CAACS,KAAK,CAAE,wCAAwC,CAAC,CACzD,CACF,CACD,CAAE,MAAOA,KAAK,CAAE,CACbN,MAAM,CAACwB,OAAO,CAACC,QAAQ,CAAG,KAAK,CAC/B5B,KAAK,CAACS,KAAK,CAACA,KAAK,CAAC4C,QAAQ,CAACtB,IAAI,CAACiB,OAAO,CAAC,CAC3C,CACF,CAAC,CAEDhF,SAAS,CAAC,IAAM,CACf,GAAIyC,KAAK,CAAE,CACVT,KAAK,CAACS,KAAK,CAACA,KAAK,CAAC,CAClBV,QAAQ,CAACZ,WAAW,CAAC,CAAC,CAAC,CACxB,CACD,CAAC,CAAE,CAACY,QAAQ,CAACU,KAAK,CAACT,KAAK,CAAC,CAAC,CAEvB,mBACAT,KAAA,CAACxB,QAAQ,EAAAuF,QAAA,eACTjE,IAAA,CAAChB,QAAQ,EAACkF,KAAK,CAAC,SAAS,CAAE,CAAC,cAC5BlE,IAAA,CAACnB,aAAa,EAACsF,UAAU,CAAE,CAAE,CAAE,CAAC,cAChCnE,IAAA,QAAKoE,SAAS,CAAC,kBAAkB,CAAAH,QAAA,cACjC/D,KAAA,SAAMkE,SAAS,CAAC,aAAa,CAACC,QAAQ,CAAGjC,CAAC,EAAKD,aAAa,CAACC,CAAC,CAAE,CAAA6B,QAAA,eAC/DjE,IAAA,CAACf,UAAU,EAAAgF,QAAA,CAAC,WAAS,CAAY,CAAC,cAClC/D,KAAA,QAAA+D,QAAA,eACGjE,IAAA,CAACP,cAAc,GAAE,CAAC,cAClBO,IAAA,CAACb,iBAAiB,EAAEiF,SAAS,CAAC,cAAc,CAAE,CAAC,EAC7C,CAAC,cACNlE,KAAA,QAAA+D,QAAA,eACGjE,IAAA,CAACN,SAAS,GAAE,CAAC,cACbM,IAAA,CAACX,iBAAiB,EAAC+E,SAAS,CAAC,cAAc,CAAE,CAAC,EAC5C,CAAC,cACNlE,KAAA,QAAA+D,QAAA,eACGjE,IAAA,CAACL,UAAU,GAAE,CAAC,cACdK,IAAA,CAACZ,cAAc,EAACgF,SAAS,CAAC,cAAc,CAAC,CAAC,EACxC,CAAC,cACNpE,IAAA,UACGsE,IAAI,CAAE,QAAQ,CACdC,KAAK,gBAAAC,MAAA,CAAYpE,SAAS,EAAIA,SAAS,CAACsB,UAAU,CAAI,CACtD+C,GAAG,CAAG3D,MAAO,CACbsD,SAAS,CAAC,gBAAgB,CAC5B,CAAC,EACG,CAAC,CACF,CAAC,EACI,CAAC,CACd,CAAC,CAGF,cAAe,CAAAjE,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}